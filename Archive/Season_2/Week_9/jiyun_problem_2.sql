WITH RECURSIVE CONSECUTIVE_PROJECT AS(
    
    SELECT A.START_DATE AS START_DATE,
    
        CASE WHEN B.END_DATE IS NULL THEN A.END_DATE
                ELSE B.END_DATE 
                END AS END_DATE
    
    FROM PROJECTS A
    LEFT JOIN PROJECTS B
        ON A.END_DATE = B.START_DATE
    
UNION ALL

    SELECT C.START_DATE AS START_DATE,
           D.END_DATE AS END_DATE
    FROM CONSECUTIVE_PROJECT C
    JOIN PROJECTS D
        ON C.END_DATE = D.START_DATE
)



SELECT DISTINCT E.START_DATE AS START,

    CASE WHEN F.END_DATE IS NULL THEN E.END_DATE 
        ELSE F.END_DATE
        END AS END
        
FROM CONSECUTIVE_PROJECT E
LEFT JOIN CONSECUTIVE_PROJECT F
    ON E.END_DATE = F.START_DATE 
    
WHERE NOT EXISTS (
      SELECT 1
    FROM CONSECUTIVE_PROJECT G
    WHERE (E.START_DATE > G.START_DATE AND E.START_DATE < G.END_DATE) OR
            (E.START_DATE = G.START_DATE AND F.END_DATE < G.END_DATE)
)

ORDER BY (END - START), START;
